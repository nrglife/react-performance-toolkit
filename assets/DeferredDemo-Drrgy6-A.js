import{j as e,h as a,t as D,l as u,g as s,F as E,s as T,u as M,o as x,p as j,r as f,S as R,y as k,v as U,L as q,w as I,x as z,D as F}from"./mui-vendor-BcogAy2T.js";import{r as i}from"./react-vendor-bYt7__KG.js";import{D as y,C as L}from"./CodeBlock-DwP4a17t.js";import{u as H}from"./useMockData-Dc5hC0Id.js";import{e as $}from"./expensiveCalculation-CrE_IYLs.js";import"./index-C8ZS78_l.js";import"./tanstack-query-qmwwa--H.js";function Z(){const{data:c,loading:O,error:v}=H(),[t,W]=i.useState(!0),[n,b]=i.useState(""),m=i.useDeferredValue(n),l=n!==m,[S,w]=i.useState(0),[p,V]=i.useState(0),o=i.useRef(0),[B,C]=i.useState(0);i.useEffect(()=>{if(l&&t)o.current===0&&(o.current=performance.now(),V(r=>r+1));else if(!l&&o.current>0){const r=performance.now()-o.current;C(g=>g+r),o.current=0}},[l,t]);const d=i.useMemo(()=>(c==null?void 0:c.medium)||[],[c]),h=i.useMemo(()=>{const r=t?m:n;return r?$(d,r):d},[d,t?m:n,t]);return O?e.jsx(y,{title:"useDeferredValue Demo",children:e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(D,{})})}):v?e.jsx(y,{title:"useDeferredValue Demo",children:e.jsxs(u,{severity:"error",children:["Error loading data: ",v.message]})}):e.jsxs(y,{title:"useDeferredValue Demo",description:"See how useDeferredValue keeps input responsive by deferring expensive updates",children:[e.jsxs(u,{severity:"info",sx:{mb:3},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"ðŸŽ¯ Try This: Type quickly in the search field below"}),e.jsxs(s,{variant:"body2",children:["This demo searches through ",e.jsxs("strong",{children:[d.length.toLocaleString()," items"]}),". Toggle between modes and ",e.jsx("strong",{children:"feel"})," the difference in responsiveness!"]})]}),e.jsx(a,{sx:{mb:3},children:e.jsx(E,{control:e.jsx(M,{checked:t,onChange:r=>{W(r.target.checked),b(""),w(0),V(0),C(0)},color:"primary"}),label:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{variant:"body1",children:t?"âœ… Optimization ON":"âŒ Optimization OFF"}),e.jsx(T,{label:t?"useDeferredValue":"Baseline",size:"small",color:t?"success":"default"})]})})}),e.jsxs(u,{severity:t?"success":"warning",sx:{mb:3},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:t?"âœ… With useDeferredValue:":"âŒ Without useDeferredValue:"}),e.jsx(s,{variant:"body2",children:t?"Search input feels smooth and responsive. You can type quickly without lag. Results update shortly after you stop typing.":"Search input feels sluggish and laggy. Each keystroke waits for the expensive search to complete before updating."})]}),t&&S>0&&e.jsxs(x,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(x,{size:{xs:12,md:4},children:e.jsx(j,{variant:"outlined",children:e.jsxs(f,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(R,{color:"primary"}),e.jsx(s,{variant:"subtitle2",children:"Keystrokes"})]}),e.jsx(s,{variant:"h4",children:S}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Total characters typed"})]})})}),e.jsx(x,{size:{xs:12,md:4},children:e.jsx(j,{variant:"outlined",children:e.jsxs(f,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(k,{color:"warning"}),e.jsx(s,{variant:"subtitle2",children:"Stale Periods"})]}),e.jsx(s,{variant:"h4",children:p}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Times results lagged behind"})]})})}),e.jsx(x,{size:{xs:12,md:4},children:e.jsx(j,{variant:"outlined",children:e.jsxs(f,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(k,{color:"primary"}),e.jsx(s,{variant:"subtitle2",children:"Avg Stale Time"})]}),e.jsxs(s,{variant:"h4",children:[p>0?(B/p).toFixed(0):"0","ms"]}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"How long results lag behind"})]})})})]}),e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(U,{fullWidth:!0,label:"Search items",value:n,onChange:r=>{b(r.target.value),w(g=>g+1)},placeholder:"Type to search... (try typing quickly!)",variant:"outlined"}),l&&t&&e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,minWidth:120},children:[e.jsx(D,{size:20}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Searching..."})]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Showing ",h.length.toLocaleString()," of ",d.length.toLocaleString()," ","items",l&&t&&e.jsx(T,{label:"Stale results",size:"small",color:"warning",sx:{ml:1}})]})]}),e.jsxs(q,{sx:{maxHeight:400,overflow:"auto",border:1,borderColor:"divider",borderRadius:1},children:[h.slice(0,50).map(r=>e.jsx(I,{divider:!0,children:e.jsx(z,{primary:r.name,secondary:`Category: ${r.category} | Value: ${r.value}`})},r.id)),h.length>50&&e.jsx(I,{children:e.jsx(z,{secondary:`... and ${(h.length-50).toLocaleString()} more items`})})]}),e.jsx(F,{sx:{my:4}}),e.jsxs(a,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Implementation"}),e.jsx(L,{title:"âœ… Optimized (with useDeferredValue)",code:`const [searchValue, setSearchValue] = useState('');
const deferredSearch = useDeferredValue(searchValue);

// Input updates immediately
const handleChange = (e) => {
  setSearchValue(e.target.value);
};

// Filtering uses deferred value (lags behind)
const filteredItems = useMemo(() => {
  if (!deferredSearch) return items;
  return expensiveFilter(items, deferredSearch);
}, [items, deferredSearch]);

// Check if showing stale results
const isStale = searchValue !== deferredSearch;`,language:"typescript"}),e.jsx(L,{title:"âŒ Baseline (without useDeferredValue)",code:`const [searchValue, setSearchValue] = useState('');

// Input updates, but waits for filtering
const handleChange = (e) => {
  setSearchValue(e.target.value);
};

// Filtering uses immediate value (blocks UI)
const filteredItems = useMemo(() => {
  if (!searchValue) return items;
  return expensiveFilter(items, searchValue);
}, [items, searchValue]);`,language:"typescript"})]}),e.jsx(F,{sx:{my:4}}),e.jsxs(a,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"How it works"}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["â€¢ ",e.jsx("strong",{children:"Immediate input:"})," Search field updates instantly as you type"]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["â€¢ ",e.jsx("strong",{children:"Deferred filtering:"})," Expensive search uses the deferred value"]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["â€¢ ",e.jsx("strong",{children:"Stale indicator:"})," Shows when results are catching up to your typing"]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["â€¢ ",e.jsx("strong",{children:"useMemo optimization:"})," Recalculates only when deferred value changes"]}),e.jsxs(u,{severity:"info",sx:{mt:2},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"ðŸ’¡ useDeferredValue vs useTransition"}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"useDeferredValue:"})," Use when you want to defer a ",e.jsx("em",{children:"value"}),' (like search input). The value "lags behind" the actual state.']}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"useTransition:"})," Use when you want to defer a ",e.jsx("em",{children:"state update"})," (like setting filter state). You control when the transition starts."]})]})]})]})}export{Z as default};
