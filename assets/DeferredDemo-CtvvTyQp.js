import{c as W,j as e,r as i,B as a,C as T,T as s,a as D,G as h,b as p,d as j,S as E}from"./index-C1pV9tnS.js";import{D as f,A as u,F as R,S as U,a as k,C as I}from"./CodeBlock-D5T1xUuw.js";import{u as H}from"./useMockData-BZN3SfMT.js";import{e as q,T as A,L as $}from"./expensiveCalculation-CAcuRtQ-.js";import{L as z,a as F}from"./ListItemText-B7w4jQzo.js";const L=W(e.jsx("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}));function X(){const{data:y,loading:M,error:v}=H(),[t,B]=i.useState(!0),[n,b]=i.useState(""),x=i.useDeferredValue(n),l=n!==x,[S,w]=i.useState(0),[m,V]=i.useState(0),o=i.useRef(0),[O,C]=i.useState(0);i.useEffect(()=>{if(l&&t)o.current===0&&(o.current=performance.now(),V(r=>r+1));else if(!l&&o.current>0){const r=performance.now()-o.current;C(g=>g+r),o.current=0}},[l,t]);const c=i.useMemo(()=>y?.medium||[],[y]),d=i.useMemo(()=>{const r=t?x:n;return r?q(c,r):c},[c,t?x:n,t]);return M?e.jsx(f,{title:"useDeferredValue Demo",children:e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(T,{})})}):v?e.jsx(f,{title:"useDeferredValue Demo",children:e.jsxs(u,{severity:"error",children:["Error loading data: ",v.message]})}):e.jsxs(f,{title:"useDeferredValue Demo",description:"See how useDeferredValue keeps input responsive by deferring expensive updates",children:[e.jsxs(u,{severity:"info",sx:{mb:3},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"ðŸŽ¯ Try This: Type quickly in the search field below"}),e.jsxs(s,{variant:"body2",children:["This demo searches through ",e.jsxs("strong",{children:[c.length.toLocaleString()," items"]}),". Toggle between modes and ",e.jsx("strong",{children:"feel"})," the difference in responsiveness!"]})]}),e.jsx(a,{sx:{mb:3},children:e.jsx(R,{control:e.jsx(U,{checked:t,onChange:r=>{B(r.target.checked),b(""),w(0),V(0),C(0)},color:"primary"}),label:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{variant:"body1",children:t?"âœ… Optimization ON":"âŒ Optimization OFF"}),e.jsx(D,{label:t?"useDeferredValue":"Baseline",size:"small",color:t?"success":"default"})]})})}),e.jsxs(u,{severity:t?"success":"warning",sx:{mb:3},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:t?"âœ… With useDeferredValue:":"âŒ Without useDeferredValue:"}),e.jsx(s,{variant:"body2",children:t?"Search input feels smooth and responsive. You can type quickly without lag. Results update shortly after you stop typing.":"Search input feels sluggish and laggy. Each keystroke waits for the expensive search to complete before updating."})]}),t&&S>0&&e.jsxs(h,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(h,{size:{xs:12,md:4},children:e.jsx(p,{variant:"outlined",children:e.jsxs(j,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(E,{color:"primary"}),e.jsx(s,{variant:"subtitle2",children:"Keystrokes"})]}),e.jsx(s,{variant:"h4",children:S}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Total characters typed"})]})})}),e.jsx(h,{size:{xs:12,md:4},children:e.jsx(p,{variant:"outlined",children:e.jsxs(j,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(L,{color:"warning"}),e.jsx(s,{variant:"subtitle2",children:"Stale Periods"})]}),e.jsx(s,{variant:"h4",children:m}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Times results lagged behind"})]})})}),e.jsx(h,{size:{xs:12,md:4},children:e.jsx(p,{variant:"outlined",children:e.jsxs(j,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(L,{color:"primary"}),e.jsx(s,{variant:"subtitle2",children:"Avg Stale Time"})]}),e.jsxs(s,{variant:"h4",children:[m>0?(O/m).toFixed(0):"0","ms"]}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"How long results lag behind"})]})})})]}),e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(A,{fullWidth:!0,label:"Search items",value:n,onChange:r=>{b(r.target.value),w(g=>g+1)},placeholder:"Type to search... (try typing quickly!)",variant:"outlined"}),l&&t&&e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,minWidth:120},children:[e.jsx(T,{size:20}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Searching..."})]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Showing ",d.length.toLocaleString()," of ",c.length.toLocaleString()," ","items",l&&t&&e.jsx(D,{label:"Stale results",size:"small",color:"warning",sx:{ml:1}})]})]}),e.jsxs($,{sx:{maxHeight:400,overflow:"auto",border:1,borderColor:"divider",borderRadius:1},children:[d.slice(0,50).map(r=>e.jsx(z,{divider:!0,children:e.jsx(F,{primary:r.name,secondary:`Category: ${r.category} | Value: ${r.value}`})},r.id)),d.length>50&&e.jsx(z,{children:e.jsx(F,{secondary:`... and ${(d.length-50).toLocaleString()} more items`})})]}),e.jsx(k,{sx:{my:4}}),e.jsxs(a,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Implementation"}),e.jsx(I,{title:"âœ… Optimized (with useDeferredValue)",code:`const [searchValue, setSearchValue] = useState('');
const deferredSearch = useDeferredValue(searchValue);

// Input updates immediately
const handleChange = (e) => {
  setSearchValue(e.target.value);
};

// Filtering uses deferred value (lags behind)
const filteredItems = useMemo(() => {
  if (!deferredSearch) return items;
  return expensiveFilter(items, deferredSearch);
}, [items, deferredSearch]);

// Check if showing stale results
const isStale = searchValue !== deferredSearch;`,language:"typescript"}),e.jsx(I,{title:"âŒ Baseline (without useDeferredValue)",code:`const [searchValue, setSearchValue] = useState('');

// Input updates, but waits for filtering
const handleChange = (e) => {
  setSearchValue(e.target.value);
};

// Filtering uses immediate value (blocks UI)
const filteredItems = useMemo(() => {
  if (!searchValue) return items;
  return expensiveFilter(items, searchValue);
}, [items, searchValue]);`,language:"typescript"})]}),e.jsx(k,{sx:{my:4}}),e.jsxs(a,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"How it works"}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["â€¢ ",e.jsx("strong",{children:"Immediate input:"})," Search field updates instantly as you type"]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["â€¢ ",e.jsx("strong",{children:"Deferred filtering:"})," Expensive search uses the deferred value"]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["â€¢ ",e.jsx("strong",{children:"Stale indicator:"})," Shows when results are catching up to your typing"]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["â€¢ ",e.jsx("strong",{children:"useMemo optimization:"})," Recalculates only when deferred value changes"]}),e.jsxs(u,{severity:"info",sx:{mt:2},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"ðŸ’¡ useDeferredValue vs useTransition"}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"useDeferredValue:"})," Use when you want to defer a ",e.jsx("em",{children:"value"}),' (like search input). The value "lags behind" the actual state.']}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"useTransition:"})," Use when you want to defer a ",e.jsx("em",{children:"state update"})," (like setting filter state). You control when the transition starts."]})]})]})]})}export{X as default};
