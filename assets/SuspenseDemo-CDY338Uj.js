import{F as ne,H as z,I as m,J as M,K as S,L as D,M as _,N as Y,O as ie,P as T,Q as ae,R as oe,U as K,V as te,r as d,W as ce,X as le,j as s,T as n,G as k,B as R,a as V,o as q,b as I,d as E,C as G}from"./index-CCjvjdD8.js";import{D as he,A as j,a as J,C as Q}from"./CodeBlock-DGa99j9B.js";var ue=class extends ne{constructor(e,t){super(),this.options=t,this.#s=e,this.#n=null,this.#r=z(),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#f=void 0;#t=void 0;#a;#h;#r;#n;#m;#u;#d;#o;#c;#i;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),X(this.#e,this.options)?this.#l():this.updateResult(),this.#g())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return B(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return B(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#R(),this.#e.removeObserver(this)}setOptions(e){const t=this.options,r=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof m(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#j(),this.#e.setOptions(this.options),t._defaulted&&!M(this.options,t)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const i=this.hasListeners();i&&$(this.#e,r,this.options,t)&&this.#l(),this.updateResult(),i&&(this.#e!==r||m(this.options.enabled,this.#e)!==m(t.enabled,this.#e)||S(this.options.staleTime,this.#e)!==S(t.staleTime,this.#e))&&this.#x();const a=this.#b();i&&(this.#e!==r||m(this.options.enabled,this.#e)!==m(t.enabled,this.#e)||a!==this.#i)&&this.#y(a)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),r=this.createResult(t,e);return pe(this,r)&&(this.#t=r,this.#h=this.options,this.#a=this.#e.state),r}getCurrentResult(){return this.#t}trackResult(e,t){return new Proxy(e,{get:(r,i)=>(this.trackProp(i),t?.(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#r.status==="pending"&&this.#r.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,i))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),r=this.#s.getQueryCache().build(this.#s,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.#l({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#l(e){this.#j();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(D)),t}#x(){this.#v();const e=S(this.options.staleTime,this.#e);if(_||this.#t.isStale||!Y(e))return;const r=ie(this.#t.dataUpdatedAt,e)+1;this.#o=T.setTimeout(()=>{this.#t.isStale||this.updateResult()},r)}#b(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#y(e){this.#R(),this.#i=e,!(_||m(this.options.enabled,this.#e)===!1||!Y(this.#i)||this.#i===0)&&(this.#c=T.setInterval(()=>{(this.options.refetchIntervalInBackground||ae.isFocused())&&this.#l()},this.#i))}#g(){this.#x(),this.#y(this.#b())}#v(){this.#o&&(T.clearTimeout(this.#o),this.#o=void 0)}#R(){this.#c&&(T.clearInterval(this.#c),this.#c=void 0)}createResult(e,t){const r=this.#e,i=this.options,a=this.#t,l=this.#a,o=this.#h,h=e!==r?e.state:this.#f,{state:f}=e;let c={...f},x=!1,u;if(t._optimisticResults){const p=this.hasListeners(),C=!p&&X(e,t),v=p&&$(e,r,t,i);(C||v)&&(c={...c,...oe(f.data,e.options)}),t._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:W,errorUpdatedAt:N,status:g}=c;u=c.data;let L=!1;if(t.placeholderData!==void 0&&u===void 0&&g==="pending"){let p;a?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(p=a.data,L=!0):p=typeof t.placeholderData=="function"?t.placeholderData(this.#d?.state.data,this.#d):t.placeholderData,p!==void 0&&(g="success",u=K(a?.data,p,t),x=!0)}if(t.select&&u!==void 0&&!L)if(a&&u===l?.data&&t.select===this.#m)u=this.#u;else try{this.#m=t.select,u=t.select(u),u=K(a?.data,u,t),this.#u=u,this.#n=null}catch(p){this.#n=p}this.#n&&(W=this.#n,u=this.#u,N=Date.now(),g="error");const P=c.fetchStatus==="fetching",U=g==="pending",O=g==="error",A=U&&P,H=u!==void 0,b={status:g,fetchStatus:c.fetchStatus,isPending:U,isSuccess:g==="success",isError:O,isInitialLoading:A,isLoading:A,data:u,dataUpdatedAt:c.dataUpdatedAt,error:W,errorUpdatedAt:N,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>h.dataUpdateCount||c.errorUpdateCount>h.errorUpdateCount,isFetching:P,isRefetching:P&&!U,isLoadingError:O&&!H,isPaused:c.fetchStatus==="paused",isPlaceholderData:x,isRefetchError:O&&H,isStale:F(e,t),refetch:this.refetch,promise:this.#r,isEnabled:m(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const p=w=>{b.status==="error"?w.reject(b.error):b.data!==void 0&&w.resolve(b.data)},C=()=>{const w=this.#r=b.promise=z();p(w)},v=this.#r;switch(v.status){case"pending":e.queryHash===r.queryHash&&p(v);break;case"fulfilled":(b.status==="error"||b.data!==v.value)&&C();break;case"rejected":(b.status!=="error"||b.error!==v.reason)&&C();break}}return b}updateResult(){const e=this.#t,t=this.createResult(this.#e,this.options);if(this.#a=this.#e.state,this.#h=this.options,this.#a.data!==void 0&&(this.#d=this.#e),M(t,e))return;this.#t=t;const r=()=>{if(!e)return!0;const{notifyOnChangeProps:i}=this.options,a=typeof i=="function"?i():i;if(a==="all"||!a&&!this.#p.size)return!0;const l=new Set(a??this.#p);return this.options.throwOnError&&l.add("error"),Object.keys(this.#t).some(o=>{const y=o;return this.#t[y]!==e[y]&&l.has(y)})};this.#S({listeners:r()})}#j(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#f=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#g()}#S(e){te.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function de(e,t){return m(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function X(e,t){return de(e,t)||e.state.data!==void 0&&B(e,t,t.refetchOnMount)}function B(e,t,r){if(m(t.enabled,e)!==!1&&S(t.staleTime,e)!=="static"){const i=typeof r=="function"?r(e):r;return i==="always"||i!==!1&&F(e,t)}return!1}function $(e,t,r,i){return(e!==t||m(i.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&F(e,r)}function F(e,t){return m(t.enabled,e)!==!1&&e.isStaleByTime(S(t.staleTime,e))}function pe(e,t){return!M(e.getCurrentResult(),t)}var se=d.createContext(!1),fe=()=>d.useContext(se);se.Provider;function me(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var xe=d.createContext(me()),be=()=>d.useContext(xe),ye=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},ge=e=>{d.useEffect(()=>{e.clearReset()},[e])},ve=({result:e,errorResetBoundary:t,throwOnError:r,query:i,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&i&&(a&&e.data===void 0||ce(r,[e.error,i])),Re=(e,t)=>t.state.data===void 0,je=e=>{if(e.suspense){const r=a=>a==="static"?a:Math.max(a??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...a)=>r(i(...a)):r(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Se=(e,t)=>e.isLoading&&e.isFetching&&!t,Ce=(e,t)=>e?.suspense&&t.isPending,Z=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function we(e,t,r){const i=fe(),a=be(),l=le(),o=l.defaultQueryOptions(e);l.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=i?"isRestoring":"optimistic",je(o),ye(o,a),ge(a);const y=!l.getQueryCache().get(o.queryHash),[h]=d.useState(()=>new t(l,o)),f=h.getOptimisticResult(o),c=!i&&e.subscribed!==!1;if(d.useSyncExternalStore(d.useCallback(x=>{const u=c?h.subscribe(te.batchCalls(x)):D;return h.updateResult(),u},[h,c]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),d.useEffect(()=>{h.setOptions(o)},[o,h]),Ce(o,f))throw Z(o,h,a);if(ve({result:f,errorResetBoundary:a,throwOnError:o.throwOnError,query:l.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw f.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(o,f),o.experimental_prefetchInRender&&!_&&Se(f,i)&&(y?Z(o,h,a):l.getQueryCache().get(o.queryHash)?.promise)?.catch(D).finally(()=>{h.updateResult()}),o.notifyOnChangeProps?f:h.trackResult(f)}function Te(e,t){return we({...e,enabled:!0,suspense:!0,throwOnError:Re,placeholderData:void 0},ue)}const Ie=e=>new Promise(t=>setTimeout(t,e)),Ee=[{id:1,name:"Alice Johnson",email:"alice@example.com",role:"Developer"},{id:2,name:"Bob Smith",email:"bob@example.com",role:"Designer"},{id:3,name:"Carol Williams",email:"carol@example.com",role:"Manager"}];async function re(e){await Ie(1e3+Math.random()*1e3);const t=Ee.find(r=>r.id===e);if(!t)throw new Error(`User ${e} not found`);return t}function Pe(e){let t="pending",r,i;const a=e.then(l=>{t="success",r=l},l=>{t="error",i=l});return{read(){switch(t){case"pending":throw a;case"error":throw i;case"success":return r}}}}function ee(e){return Pe(re(e))}function Ue({userId:e}){const{data:t}=Te({queryKey:["user",e],queryFn:()=>re(e)});return s.jsx(I,{children:s.jsxs(E,{children:[s.jsx(n,{variant:"h6",gutterBottom:!0,children:t.name}),s.jsxs(n,{variant:"body2",color:"text.secondary",children:["Email: ",t.email]}),s.jsxs(n,{variant:"body2",color:"text.secondary",children:["Role: ",t.role]})]})})}function Oe({resource:e}){const t=e.read();return s.jsx(I,{children:s.jsxs(E,{children:[s.jsx(n,{variant:"h6",gutterBottom:!0,children:t.name}),s.jsxs(n,{variant:"body2",color:"text.secondary",children:["Email: ",t.email]}),s.jsxs(n,{variant:"body2",color:"text.secondary",children:["Role: ",t.role]})]})})}function De(){const[e,t]=d.useState(1),[r,i]=d.useState(1),[a,l]=d.useState(()=>ee(1)),o=()=>{const x=e%3+1;t(x)},y=()=>{const x=r%3+1;i(x),l(ee(x))};return s.jsxs(he,{title:"Suspense Demo",description:"Compare TanStack Query (production) vs Pure React Suspense (educational) approaches to data loading",children:[s.jsxs(j,{severity:"info",sx:{mb:3},children:[s.jsx(n,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:'üéØ Try This: Click the "Load Next User" buttons'}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"Watch how both approaches handle loading states automatically. No manual loading flags needed!"}),s.jsx(n,{variant:"body2",sx:{fontStyle:"italic",fontSize:"0.875rem"},children:"üí° Notice: The loading spinner appears automatically while data fetches (1-2 second delay)"})]}),s.jsxs(k,{container:!0,spacing:3,sx:{mb:3},children:[s.jsx(k,{size:{xs:12,md:6},children:s.jsxs(R,{children:[s.jsxs(R,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[s.jsx(n,{variant:"h6",children:"TanStack Query"}),s.jsx(V,{label:"Production",color:"success",size:"small"})]}),s.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Recommended for real applications. Includes caching, refetching, and error handling."}),s.jsxs(q,{variant:"contained",onClick:o,sx:{mb:2},children:["Load Next User (ID: ",e%3+1,")"]}),s.jsx(d.Suspense,{fallback:s.jsx(I,{children:s.jsx(E,{sx:{display:"flex",justifyContent:"center",py:4},children:s.jsx(G,{})})}),children:s.jsx(Ue,{userId:e})})]})}),s.jsx(k,{size:{xs:12,md:6},children:s.jsxs(R,{children:[s.jsxs(R,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[s.jsx(n,{variant:"h6",children:"Pure React Suspense"}),s.jsx(V,{label:"Educational",color:"primary",size:"small"})]}),s.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Shows how Suspense works under the hood. Great for learning, not for production."}),s.jsxs(q,{variant:"contained",onClick:y,sx:{mb:2},children:["Load Next User (ID: ",r%3+1,")"]}),s.jsx(d.Suspense,{fallback:s.jsx(I,{children:s.jsx(E,{sx:{display:"flex",justifyContent:"center",py:4},children:s.jsx(G,{})})}),children:s.jsx(Oe,{resource:a})})]})})]}),s.jsxs(j,{severity:"success",sx:{mb:3},children:[s.jsx(n,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"‚úÖ What Makes Suspense Special"}),s.jsxs(n,{variant:"body2",sx:{mb:1},children:["‚Ä¢ ",s.jsx("strong",{children:"No loading state management:"})," No useState(loading) needed"]}),s.jsxs(n,{variant:"body2",sx:{mb:1},children:["‚Ä¢ ",s.jsx("strong",{children:"Declarative:"})," Just wrap components in Suspense boundary"]}),s.jsxs(n,{variant:"body2",sx:{mb:1},children:["‚Ä¢ ",s.jsx("strong",{children:"Composable:"})," Multiple components can suspend independently"]}),s.jsxs(n,{variant:"body2",children:["‚Ä¢ ",s.jsx("strong",{children:"Automatic:"})," React handles showing/hiding fallback UI"]})]}),s.jsx(J,{sx:{my:4}}),s.jsxs(R,{children:[s.jsx(n,{variant:"h6",gutterBottom:!0,children:"Implementation Comparison"}),s.jsx(Q,{title:"‚úÖ TanStack Query (Recommended for Production)",code:`import { useSuspenseQuery } from '@tanstack/react-query';

function UserProfile({ userId }) {
  // useSuspenseQuery automatically suspends while loading
  const { data: user } = useSuspenseQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
  });

  return <div>{user.name}</div>;
}

// Wrap in Suspense boundary
<Suspense fallback={<Loading />}>
  <UserProfile userId={1} />
</Suspense>

// ‚úÖ Benefits:
// - Automatic caching and refetching
// - Built-in error handling
// - DevTools for debugging
// - Production-ready`,language:"typescript"}),s.jsx(Q,{title:"üéì Pure React Suspense (Educational)",code:`import { wrapPromise } from './utils/wrapPromise';

// Create resource outside component
const userResource = wrapPromise(fetchUser(1));

function UserProfile({ resource }) {
  // read() throws promise while loading - Suspense catches it!
  const user = resource.read();
  return <div>{user.name}</div>;
}

// Wrap in Suspense boundary
<Suspense fallback={<Loading />}>
  <UserProfile resource={userResource} />
</Suspense>

// ‚úÖ Benefits:
// - Educational: shows how Suspense works
// - No dependencies needed
// - Full control over data flow`,language:"typescript"}),s.jsx(Q,{title:"üîç How wrapPromise Works (The Magic Behind Suspense)",code:`function wrapPromise<T>(promise: Promise<T>) {
  let status = 'pending';
  let result: T;

  const suspender = promise.then(
    (data) => {
      status = 'success';
      result = data;
    }
  );

  return {
    read(): T {
      if (status === 'pending') {
        throw suspender; // Suspense catches this!
      }
      return result;
    },
  };
}

// This is the "magic" behind Suspense:
// - Component throws a promise
// - React catches it and shows fallback
// - When promise resolves, React re-renders component`,language:"typescript"})]}),s.jsx(J,{sx:{my:4}}),s.jsxs(R,{children:[s.jsx(n,{variant:"h6",gutterBottom:!0,children:"Understanding Suspense"}),s.jsxs(j,{severity:"info",sx:{mb:2},children:[s.jsx(n,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"ü§î How Does Suspense Work?"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"1. Component tries to read data that's not ready yet"}),s.jsxs(n,{variant:"body2",sx:{mb:1},children:["2. Component ",s.jsx("strong",{children:"throws a promise"})," (yes, really!)"]}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"3. React catches the thrown promise"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"4. React shows the fallback UI (loading spinner)"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"5. When promise resolves, React re-renders the component"}),s.jsx(n,{variant:"body2",children:"6. Component reads data successfully and renders"})]}),s.jsx(n,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"When to Use Each Approach"}),s.jsxs(j,{severity:"success",sx:{mb:2},children:[s.jsx(n,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"‚úÖ Use TanStack Query When:"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"‚Ä¢ Building a production application"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"‚Ä¢ You need caching, refetching, and error handling"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"‚Ä¢ You want DevTools for debugging"}),s.jsx(n,{variant:"body2",children:"‚Ä¢ You need features like pagination, infinite scroll, etc."})]}),s.jsxs(j,{severity:"warning",sx:{mb:2},children:[s.jsx(n,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"üéì Use Pure React Suspense When:"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"‚Ä¢ Learning how Suspense works under the hood"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"‚Ä¢ Building a simple demo or prototype"}),s.jsx(n,{variant:"body2",sx:{mb:1},children:"‚Ä¢ You want full control over data fetching"}),s.jsx(n,{variant:"body2",children:"‚Ä¢ You're integrating with a custom data layer"})]}),s.jsxs(j,{severity:"error",children:[s.jsx(n,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"‚ö†Ô∏è Common Mistakes to Avoid"}),s.jsxs(n,{variant:"body2",sx:{mb:1},children:["‚Ä¢ ",s.jsx("strong",{children:"Creating resources inside components:"})," This causes infinite loops! Create resources outside or use state."]}),s.jsxs(n,{variant:"body2",sx:{mb:1},children:["‚Ä¢ ",s.jsx("strong",{children:"Forgetting Suspense boundary:"})," Components that suspend must be wrapped in Suspense."]}),s.jsxs(n,{variant:"body2",children:["‚Ä¢ ",s.jsx("strong",{children:"Using pure Suspense in production:"})," Use TanStack Query or similar library for real apps."]})]})]})]})}export{De as default};
